<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SceneCraft AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col items-center py-10 px-4">

  <div class="max-w-3xl w-full bg-white shadow-xl rounded-2xl p-6 space-y-6 border-t-8 border-indigo-700">
    <h1 class="text-3xl font-bold text-indigo-700 text-center">üé¨ SceneCraft AI</h1>
    <p class="text-sm text-center text-gray-600">Cinematic Analysis for Scriptwriters & Filmmakers</p>

    <textarea id="sceneInput" rows="10" placeholder="Paste your cinematic scene, dialogue, monologue, or script excerpt here..." class="w-full p-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none"></textarea>

    <input id="passwordInput" type="password" placeholder="Enter access password" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />

    <div class="flex items-center space-x-2">
      <input type="checkbox" id="agreementCheckbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded" />
      <label for="agreementCheckbox" class="text-sm text-gray-700">
        I agree to the <a href="/terms" target="_blank" class="underline text-indigo-600">Terms & Conditions</a> and Usage Policy.
      </label>
    </div>

    <button id="submitButton" disabled class="w-full bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700 transition">
      Analyze Scene
    </button>

    <div id="loading" class="text-center text-sm text-gray-500 hidden">Analyzing... please wait ‚è≥</div>

    <div id="resultBox" class="hidden bg-gray-50 border border-gray-300 rounded-lg p-4 whitespace-pre-wrap text-sm text-gray-800"></div>

    <div id="errorBox" class="hidden bg-red-100 text-red-800 border border-red-300 rounded-lg p-3 text-sm"></div>
  </div>

  <script>
    // ‚úÖ UPDATE THIS TO MATCH YOUR BACKEND URL (Render or localhost)
    const API_BASE_URL = "https://screencraft-backend.onrender.com";

    const submitButton = document.getElementById("submitButton");
    const sceneInput = document.getElementById("sceneInput");
    const passwordInput = document.getElementById("passwordInput");
    const checkbox = document.getElementById("agreementCheckbox");
    const resultBox = document.getElementById("resultBox");
    const errorBox = document.getElementById("errorBox");
    const loading = document.getElementById("loading");

    checkbox.addEventListener("change", () => {
      submitButton.disabled = !checkbox.checked;
    });

    submitButton.addEventListener("click", async () => {
      const scene = sceneInput.value.trim();
      const password = passwordInput.value.trim();

      resultBox.classList.add("hidden");
      errorBox.classList.add("hidden");
      loading.classList.remove("hidden");

      if (!scene || !password) {
        errorBox.textContent = "Please enter both scene and password.";
        errorBox.classList.remove("hidden");
        loading.classList.add("hidden");
        return;
      }

      try {
        const res = await fetch(`${API_BASE_URL}/analyze`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${password}`,
            "X-User-Agreement": "true"
          },
          body: JSON.stringify({ scene })
        });

        const data = await res.json();
        loading.classList.add("hidden");

        if (!res.ok) {
          errorBox.textContent = data.detail || "An error occurred.";
          errorBox.classList.remove("hidden");
        } else {
          resultBox.textContent = data.analysis + "\n\n" + (data.notice || "");
          resultBox.classList.remove("hidden");
        }
      } catch (err) {
        loading.classList.add("hidden");
        errorBox.textContent = "Network or server error. Please check your connection.";
        errorBox.classList.remove("hidden");
      }
    });
  </script>

</body>
</html>
