<script>
  let authorized = false;
  let authToken = "";

  async function analyzeScene() {
    const scene = document.getElementById("sceneInput").value.trim();
    const output = document.getElementById("output");
    const button = document.getElementById("analyzeBtn");

    if (!authorized) {
      const input = prompt("Enter SceneCraft Access Key:");
      if (!input || !input.startsWith("SCENECRAFT-")) {
        output.innerText = "❌ Invalid or missing password.";
        return;
      }
      authToken = input;
      authorized = true;
    }

    if (!scene || scene.length < 30) {
      output.innerText = "❗ Please input valid cinematic content (30+ characters).";
      return;
    }

    output.innerText = "⏳ Analyzing...";
    button.disabled = true;

    try {
      const response = await fetch("https://screencraft-backend.onrender.com/analyze", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + authToken
        },
        body: JSON.stringify({ scene })
      });
      const data = await response.json();
      output.innerText = data.analysis || data.error || "❗ Unexpected response.";
    } catch (err) {
      output.innerText = "❗ Request failed: " + err.message;
    }

    button.disabled = false;
  }
</script>
